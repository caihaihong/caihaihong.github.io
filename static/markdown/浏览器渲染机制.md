#### 浏览器渲染机制

* Web浏览器是一种软件，它从远程服务器（或者本地磁盘）加载文件并将其显示并且用户可以与之交互。
* 浏览器引擎：在不同的浏览器中，浏览器的某个部分会根据它接收到的文件确定显示什么，这就是所谓的浏览器引擎。浏览器引擎是每一种主流浏览器的核心软件组件，不同的浏览器开发商用不同的名字来称呼他们的引擎。Firefox：Gecko，Chrome：Blink，Webkit的一个分支。
* 发送 & 接收信息：数据是以“数据包”的形式通过互联网发送，而数据包以字节为单位。
* 计算机：只懂字节数,浏览器读取的是原始数据字节，而不是编写的实际代码。
* DOM：文档树结构，文档模型
* CSSOM：CSS树结构，层叠样式表对象模型

#####  加载过程
当浏览器接收到原始数据字节并启动DOM构建解析HTML过程时，它还会发出请求来获取链接的CSS样式表。浏览器还是接收CSS数据的原始字节，从服务器或是本地磁盘。

##### 浏览器如何处理这些CSS数据的原始字节

从CSS的原始字节到CSSOM，当浏览器接收到CSS的原始字节时，会启动一个和处理HTML原始字节类似的过程。就是说，原始数据字节被转换成字符，然后标记，然后形成节点，最后形成树结构。

CSS级联是浏览器确定如何在元素上应用样式的机制。

由于影响元素的样式可能来自父元素，即通过继承，或者已经在元素本身设置。浏览器必须递归遍历CSS树结构并确定影响特定元素的样式。

##### 渲染树
 回流（reflow）：指的是网络浏览器为了重新渲染部分或全部的文档而重新计算文档中元素的位置和几何结构的过程。页面上节点是以树的形式展现的，我们通过js将页面上的一个节点删除，此时为了不让剩下的节点脱节，将断点结合起来重新形成一棵树。而这个重新结合过程就是回流。就是由于某些修改，要将元素回过头来重新“流”一遍。
![image](https://github.com/caihaihong/caihaihong.github.io/blob/master/imgs/broswer/3.png?raw=true)
![image](https://github.com/caihaihong/caihaihong.github.io/blob/master/imgs/broswer/4.png?raw=true)

##### 渲染阻塞资源（render-blocking）
###### “有东西阻止了屏幕上节点的实际绘制”。
优化网站的第一准则是让最重要的HTML和CSS尽可能快地传递到客户端。在成功绘制之前，必须构造DOM和CSSOM，因此HTML和CSS都是渲染阻塞资源。

##### JavaScript如何执行

**当浏览器遇到脚本标签时，DOM 构造就会暂停!** 整个 DOM构建过程都将停止，直到脚本执行完成。这是因为 JavaScript 可以同时修改DOM和CSSOM。由于浏览器不确定特定的JavaScript会做什么，所以它采取的预防措施是停止整个DOM构造。

#### CSS如何执行

当解析器遇到一个脚本标签而CSSOM还没有准备好时，Javascript执行将会停止，直到CSSOM就绪。
![image](https://github.com/caihaihong/caihaihong.github.io/blob/master/imgs/broswer/7.png?raw=true)

DOM遇到脚本标签时会停止，但CSSOM不会发生这种情况。对于 CSSOM，JS执行会等待。没有CSSOM，就没有JS执行。

##### async 属性
在默认情况下，每个脚本都是一个解析器阻断器！DOM 的构建总是会被打断。不过，有一种方法可以改变这种默认行为。如果将async关键字添加到脚本标签中，那么DOM构造就不会停止。DOM 构造将继续，脚本将在下载完成并准备就绪后执行。

##### 关键渲染路径

从接收HTML、CSS和JS字节到将它们转换为屏幕上的像素之间的所有步骤。这整个过程称为**关键渲染路径**。优化网站性能就是优化关键渲染路径。

一个经过良好优化的站点应该能够渐进式渲染，而不是让整个过程受阻。